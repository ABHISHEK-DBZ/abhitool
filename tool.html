<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileForge - Tool</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- All Libraries - Load in correct order -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

    <link rel="stylesheet" href="styles.css">

    <style>
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .back-button:hover {
            background: var(--bg-tertiary);
            transform: translateX(-5px);
        }
    </style>
</head>

<body>
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <p id="loading-text">Processing...</p>
    </div>

    <header class="header">
        <div class="container">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                </svg>
                FileForge
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <a href="index.html" class="back-button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                Back to Tools
            </a>

            <!-- Tool will load here -->
            <div id="tool-container"></div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 FileForge</p>
        </div>
    </footer>

    <script src="app.js"></script>
    <script src="js/core/batch-processor.js"></script>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Get tool ID from URL
        const params = new URLSearchParams(window.location.search);
        const toolId = params.get('id');

        // Tool mapping
        const toolMap = {
            // PDF Tools
            'pdf-merge': { script: 'pdf-tools.js', container: 'pdf-tools' },
            'pdf-page-ops': { script: 'js/pdf/pdf-page-ops.js', container: 'pdf-page-ops' },
            'pdf-page-numbers': { script: 'js/pdf/pdf-page-numbers.js', container: 'pdf-page-numbers' },
            'pdf-security': { script: 'js/pdf/pdf-security.js', container: 'pdf-security' },
            'pdf-signature': { script: 'js/pdf/pdf-signature.js', container: 'pdf-signature' },
            'pdf-form-filling': { script: 'js/pdf/pdf-form-filling.js', container: 'pdf-form-filling' },
            'pdf-annotations': { script: 'js/pdf/pdf-annotations.js', container: 'pdf-annotations' },
            'pdf-editor': { script: 'pdf-editor.js', container: 'pdf-editor' },
            'pdf-summary': { script: 'pdf-summary.js', container: 'pdf-summary' },

            // Image Tools
            'image-crop': { script: 'js/image/image-crop.js', container: 'image-crop' },
            'image-compress': { script: 'js/image/image-compress.js', container: 'image-compression' },
            'background-removal': { script: 'js/image/background-remove.js', container: 'background-removal' },
            'image-resize': { script: 'image-resize.js', container: 'image-resize' },
            'image-filters': { script: 'image-filters.js', container: 'image-filters' },

            // Converters
            'pdf-to-image': { script: 'js/converters/pdf-to-image.js', container: 'pdf-to-image' },
            'html-to-pdf': { script: 'js/converters/html-to-pdf.js', container: 'html-to-pdf' },
            'markdown-to-pdf': { script: 'js/converters/markdown-to-pdf.js', container: 'markdown-to-pdf' },
            'image-to-pdf': { script: 'image-to-pdf.js', container: 'image-to-pdf' },
            'image-to-doc': { script: 'image-to-doc.js', container: 'image-to-doc' },
            'file-converter': { script: 'file-converter.js', container: 'file-converter' },

            // Utilities
            'qr-tools': { script: 'js/tools/qr-tools.js', container: 'qr-tools', needsQR: true },
            'document-scanner': { script: 'js/tools/document-scanner.js', container: 'document-scanner' },
            'ocr-tool': { script: 'ocr-tool.js', container: 'ocr-tool' },
            'archive-tools': { script: 'archive-tools.js', container: 'archive-tools' },
            'video-converter': { script: 'video-converter.js', container: 'video-converter' }
        };

        if (toolId && toolMap[toolId]) {
            const tool = toolMap[toolId];

            // Create container
            const container = document.createElement('div');
            container.id = tool.container;
            document.getElementById('tool-container').appendChild(container);

            // Load QRCode library if needed
            if (tool.needsQR) {
                const qrScript = document.createElement('script');
                qrScript.src = 'https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js';
                qrScript.onload = () => {
                    console.log('✅ QRCode library loaded');
                    loadToolScript();
                };
                document.head.appendChild(qrScript);

                const jsqrScript = document.createElement('script');
                jsqrScript.src = 'https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js';
                document.head.appendChild(jsqrScript);
            } else {
                loadToolScript();
            }

            function loadToolScript() {
                const script = document.createElement('script');
                script.src = tool.script;
                script.onload = () => console.log(`✅ ${toolId} loaded`);
                script.onerror = () => console.error(`❌ Failed to load ${toolId}`);
                document.body.appendChild(script);
            }
        } else {
            document.getElementById('tool-container').innerHTML = `
                <div style="text-align: center; padding: 4rem 0;">
                    <h2>Tool not found</h2>
                    <p>Please select a tool from the homepage.</p>
                    <a href="index.html" class="btn-primary" style="margin-top: 2rem; display: inline-block;">Go to Homepage</a>
                </div>
            `;
        }
    </script>
</body>

</html>